# Root directory of the Apache server installation.
ServerRoot "/usr/local/apache2"

# Port on which the server will listen for incoming requests.
Listen 80

# Load essential Apache modules. This is a good minimal set.
LoadModule mpm_event_module modules/mod_mpm_event.so
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule dir_module modules/mod_dir.so
LoadModule mime_module modules/mod_mime.so
LoadModule headers_module modules/mod_headers.so
LoadModule alias_module modules/mod_alias.so
LoadModule log_config_module modules/mod_log_config.so
LoadModule unixd_module modules/mod_unixd.so

# ServerName used for redirects and error pages.
ServerName localhost

# The main directory from which Apache will serve files.
DocumentRoot "/usr/local/apache2/htdocs"

# User and Group under which the server will run.
User daemon
Group daemon

# Default permissions for the DocumentRoot.
<Directory "/usr/local/apache2/htdocs">
    Options FollowSymLinks
    AllowOverride None
    Require all granted
</Directory>

# Specific configuration for the directory where processed images are stored.
<Directory "/usr/local/apache2/htdocs/images">
    Options FollowSymLinks 
    AllowOverride None
    Require all granted
</Directory>

# Default file to serve when a directory is requested.
DirectoryIndex index.html

# Apply CORS and Cache headers to image files.
<FilesMatch "\.(png|jpg|jpeg|gif)$">
    # Set CORS headers to allow images to be fetched from any origin.
    Header set Access-Control-Allow-Origin "*"

    # Set Cache-Control header to tell browsers they can cache the image for 1 hour (3600 seconds).
    Header set Cache-Control "max-age=3600"
</FilesMatch>

# Specifies the file that maps file extensions to MIME types.
TypesConfig conf/mime.types

# Redirect standard error and access logs to the container's stdout and stderr.
ErrorLog /proc/self/fd/2
CustomLog /proc/self/fd/1 common
LogLevel warn